#include <Wire.h>
#include <Keypad.h>
#include <LiquidCrystal_I2C.h>

#define digitlength 5   // 4 digits + null terminator
int pwd = 1234;

char Data[digitlength];
byte data_count = 0;
char customKey;

const byte ROWS = 4;
const byte COLS = 4;

char hexakeys[ROWS][COLS] = {
  {'1','2','3','A'},
  {'4','5','6','B'},
  {'7','8','9','C'},
  {'*','0','#','D'}
};

byte rowpins[ROWS] = {9, 8, 7, 6};
byte colpins[COLS] = {5, 4, 3, 2};

Keypad customkeypad = Keypad(makeKeymap(hexakeys), rowpins, colpins, ROWS, COLS);

// Common LCD constructor for 16x2 I2C displays
LiquidCrystal_I2C lcd(0x27, 16, 2);

void setup() {
  Serial.begin(9600);
  lcd.init();
  lcd.backlight();
}

void loop() {

  lcd.setCursor(0, 0);
  lcd.print("Enter password");

  customKey = customkeypad.getKey();

  if (customKey) {
    
    // Store key
    Data[data_count] = customKey;

    // Display it on the second line
    lcd.setCursor(data_count, 1);
    lcd.print('*'); // Hide typed password

    data_count++;
  }

  // When the user has entered 4 digits
  if (data_count == digitlength - 1) {

    Data[data_count] = '\0'; // Null-terminate the string
    lcd.clear();

    int entered = String(Data).toInt();

    if (entered == pwd) {
      lcd.print("Success!");
    } else {
      lcd.print("Failed!");
    }

    delay(1500);
    lcd.clear();

    // Reset for next try
    data_count = 0;
  }
}
